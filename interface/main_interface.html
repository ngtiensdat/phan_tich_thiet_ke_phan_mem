<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký tín chỉ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="trang_chu.css">
    <script defer src="script.js"></script>
</head>

<body>
<div class = "all">
    <div class="sidebar">
        <img src="https://phenikaa-uni.edu.vn:3600/pu/vi/modules/logo-white_20210219042705.png" alt="Phenikaa Logo"
            class="sidebar-logo" width="150">
        <a onclick="showSection('home-info')"><i class="fas fa-home"></i> Trang chủ</a>
        <a onclick="showSection('student-info')"><i class="fas fa-user-graduate"></i> Thông tin học sinh</a>
        <a onclick="showSection('course-list')"><i class="fas fa-book"></i> Danh sách môn học</a>
        <a onclick="showSection('teacher-list')"><i class="fas fa-chalkboard-teacher"></i> Giáo viên</a>
        <a onclick="showSection('schedule')"><i class="fas fa-calendar-alt"></i> Thời khóa biểu</a>
        <a onclick="showSection('registration')"><i class="fas fa-edit"></i> Đăng ký học</a>
        <button class="logout-button" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
    </div>
    <div class="content">
        <div id="home-info" class="home-info" style="display: none;">
            <!-- Hero Section -->
            <section class="hero">
                <div class="hero-container">
                    <img src="../img/san_truong.jpg" alt="Mô tả ảnh" class="hero-image">
                    <div class="hero-text">
                        <h1>Hệ thống đăng ký tín chỉ</h1>
                        <p>Quản lý việc đăng ký môn học một cách dễ dàng và thuận tiện.</p>
                        <a href="#" class="btn">Bắt đầu ngay</a>
                    </div>
                </div>
            </section>            
            
            <!-- Thông tin người dùng -->
            <div class="welcome-section">
                <h2>Chào mừng, <span id="user-email"></span></h2>
                <p>Hệ thống giúp sinh viên dễ dàng đăng ký các môn học, xem lịch học và thông tin cá nhân.</p>
                <p>Vui lòng chọn các mục trong thanh bên để thao tác.</p>
            </div>

            <!-- Môn học mới nhất -->
            <section class="latest-courses">
                <h2>Môn học mới nhất. <a href="#">Xem ngay.</a></h2>

                <!-- Nút chuyển đổi -->
                <button id="prev-btn" class="slider-btn left">&lt;</button>
                <button id="next-btn" class="slider-btn right">&gt;</button>

                <!-- Danh sách khóa học -->
                <div class="course-container">
                    <div class="course-list">
                        <div class="course-card"><img src="math.jpg" alt="Toán cao cấp">
                            <h3>Toán cao cấp</h3>
                            <p>Giải quyết các bài toán phức tạp.</p>
                            <p class="credits">Số tín chỉ: 3</p>
                        </div>
                        <div class="course-card"><img src="cs.jpg" alt="Lập trình C++">
                            <h3>Lập trình C++</h3>
                            <p>Học lập trình hướng đối tượng.</p>
                            <p class="credits">Số tín chỉ: 4</p>
                        </div>
                        <div class="course-card dark-theme"><img src="ai.jpg" alt="Trí tuệ nhân tạo">
                            <h3>Trí tuệ nhân tạo</h3>
                            <p><span class="highlight">Khóa học đặc biệt</span></p>
                            <p class="credits">Số tín chỉ: 5</p>
                        </div>
                        <div class="course-card"><img src="db.jpg" alt="Cơ sở dữ liệu">
                            <h3>Cơ sở dữ liệu</h3>
                            <p>Quản lý dữ liệu chuyên sâu.</p>
                            <p class="credits">Số tín chỉ: 3</p>
                        </div>
                        <div class="course-card"><img src="network.jpg" alt="Mạng máy tính">
                            <h3>Mạng máy tính</h3>
                            <p>Tìm hiểu về hệ thống mạng.</p>
                            <p class="credits">Số tín chỉ: 3</p>
                        </div>
                        <div class="course-card dark-theme"><img src="ml.jpg" alt="Machine Learning">
                            <h3>Machine Learning</h3>
                            <p>Ứng dụng AI vào thực tế.</p>
                            <p class="credits">Số tín chỉ: 4</p>
                        </div>
                        <div class="course-card dark-theme"><img src="ml.jpg" alt="Machine Learning">
                            <h3>Machine Learning</h3>
                            <p>Ứng dụng AI vào thực tế.</p>
                            <p class="credits">Số tín chỉ: 4</p>
                        </div>
                        <div class="course-card dark-theme"><img src="ml.jpg" alt="Machine Learning">
                            <h3>Machine Learning</h3>
                            <p>Ứng dụng AI vào thực tế.</p>
                            <p class="credits">Số tín chỉ: 4</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <section class="features">
                <div class="feature">
                    <h2>Chọn khóa học dễ dàng</h2>
                    <p>Tìm kiếm và đăng ký lớp học theo sở thích.</p>
                </div>
                <div class="feature">
                    <h2>Quản lý thời khóa biểu</h2>
                    <p>Xem lịch học chi tiết và tránh trùng lặp.</p>
                </div>
                <div class="feature">
                    <h2>Hỗ trợ 24/7</h2>
                    <p>Liên hệ bộ phận hỗ trợ nếu gặp vấn đề.</p>
                </div>
            </section>
        </div>


        <div id="registration" class="registration">
            <h2>Đăng ký học</h2>
            <div id="course-container" class="course-container"></div>
            <div id="class-container" class="class-container"></div>
            <h3>Lớp đã đăng ký:</h3>
            <ul id="registered-classes"></ul>
        </div>

        <div id="student-info" class="student-info" style="display: none;">
            <div class="student-info-container">
                <img id="student-avatar" src="default-avatar.png" alt="Ảnh đại diện" class="avatar">
                <div class="student-info-content">
                    <div class="student-info-title">THÔNG TIN CƠ BẢN</div>
                    <div class="student-info-grid">
                        <p><strong>Mã SV:</strong> <input type="text" id="student-id" disabled></p>
                        <p><strong>Họ và đệm:</strong> <input type="text" id="student-lastname" disabled></p>
                        <p><strong>Ngày sinh:</strong> <input type="date" id="student-dob" disabled></p>
                        <p><strong>Tên:</strong> <input type="text" id="student-firstname" disabled></p>
                        <p><strong>Khóa đào tạo:</strong> <input type="text" id="student-course" disabled></p>
                        <p><strong>Lớp:</strong> <input type="text" id="student-class" disabled></p>
                        <p><strong>Niên khóa:</strong> <input type="text" id="student-year" disabled></p>
                        <p><strong>Khoa quản lý:</strong> <input type="text" id="student-faculty" disabled></p>
                        <p><strong>Email:</strong> <input type="email" id="student-email" disabled></p>
                        <p><strong>Ngành:</strong> <input type="text" id="student-major" disabled></p>
                        <p><strong>Giới tính:</strong>
                            <select id="student-gender" disabled>
                                <option value="Nam">Nam</option>
                                <option value="Nữ">Nữ</option>
                                <option value="Khác">Khác</option>
                            </select>
                        </p>
                        <p><strong>Hệ đào tạo:</strong> <input type="text" id="student-system" disabled></p>
                        <p><strong>Trạng thái:</strong> <input type="text" id="student-status" disabled></p>
                        <p><strong>Chức vụ:</strong> <input type="text" id="student-role" disabled></p>
                        <p><strong>Chương trình đào tạo:</strong> <input type="text" id="student-program" disabled></p>
                    </div>
                    <button id="edit-info-btn" onclick="enableEdit()">Cập nhật thông tin</button>
                    <button id="save-info-btn" onclick="saveStudentInfo()" style="display: none;">Lưu thông tin</button>
                </div>
            </div>
        </div>
    </div>
</div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDla-CSFtR6-y2vscJjuX6Q0vp0x0TTLT4",
            authDomain: "dangkytinchi-73b7a.firebaseapp.com",
            projectId: "dangkytinchi-73b7a",
            storageBucket: "dangkytinchi-73b7a.appspot.com",
            databaseURL: "https://dangkytinchi-73b7a-default-rtdb.firebaseio.com",
            messagingSenderId: "1013393708459",
            appId: "1:1013393708459:web:21be9269a148ed83386eee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth();

        let currentUserEmail = "";
        let currentUserId = "";

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserEmail = user.email;
                currentUserId = user.email.split('@')[0];
                document.getElementById("user-email").textContent = currentUserEmail;

                loadStudentInfo();
                loadCourses();
                loadRegisteredClasses();
            } else {
                window.location.href = "login.html";
            }
        });
        function loadCourses() {
            const courseContainer = document.getElementById("course-container");
            courseContainer.innerHTML = "";

            // Danh sách môn học & lịch cố định
            const courses = [
                { id: "LTW", name: "Lập trình Web", times: [{ day: "Thứ 2", time: "6h45-9h25" }, { day: "Thứ 5", time: "9h30-12h10" }] },
                { id: "LTC", name: "Lập trình C", times: [{ day: "Thứ 3", time: "9h30-12h10" }] },
                { id: "LTCpp", name: "Lập trình C++", times: [{ day: "Thứ 2", time: "13h-15h40" }, { day: "Thứ 6", time: "15h45-18h25" }] },
                { id: "CTDL", name: "Cấu trúc dữ liệu", times: [{ day: "Thứ 4", time: "6h45-9h25" }] },
                { id: "HDH", name: "Hệ điều hành", times: [{ day: "Thứ 3", time: "13h-15h40" }, { day: "Thứ 5", time: "6h45-9h25" }] },
                { id: "CSDL", name: "Cơ sở dữ liệu", times: [{ day: "Thứ 2", time: "9h30-12h10" }] },
                { id: "THVP", name: "Tin học văn phòng", times: [{ day: "Thứ 4", time: "13h-15h40" }, { day: "Thứ 6", time: "9h30-12h10" }] },
                { id: "AI", name: "Trí tuệ nhân tạo", times: [{ day: "Thứ 5", time: "15h45-18h25" }] },
                { id: "DPT", name: "Đồ họa máy tính", times: [{ day: "Thứ 3", time: "6h45-9h25" }, { day: "Thứ 6", time: "13h-15h40" }] },
                { id: "TTNT", name: "Xử lý ngôn ngữ tự nhiên", times: [{ day: "Thứ 4", time: "9h30-12h10" }] }
            ];

            courses.forEach(course => {
                const courseBox = document.createElement("div");
                courseBox.className = "course-box";
                courseBox.textContent = course.name;
                courseBox.onclick = () => showClasses(course);
                courseContainer.appendChild(courseBox);
            });
        }

        function showClasses(course) {
            const classContainer = document.getElementById("class-container");
            classContainer.innerHTML = "";

            const courseData = {
                "LTW": { teachers: ["Nguyễn Văn A", "Trần Thị B"], rooms: ["P101", "P102"] },
                "LTC": { teachers: ["Phạm Văn C"], rooms: ["P201"] },
                "LTCpp": { teachers: ["Nguyễn Văn E", "Trần Văn F"], rooms: ["P301", "P302"] },
                "CTDL": { teachers: ["Lê Thị G"], rooms: ["P401"] },
                "HDH": { teachers: ["Phạm Văn I", "Nguyễn Văn J"], rooms: ["P501", "P502"] },
                "CSDL": { teachers: ["Trần Minh K"], rooms: ["P601"] },
                "THVP": { teachers: ["Nguyễn Thị M", "Phạm Văn N"], rooms: ["P701", "P702"] },
                "AI": { teachers: ["Lê Thị O"], rooms: ["P801"] },
                "DPT": { teachers: ["Trần Minh Q", "Nguyễn Văn R"], rooms: ["P901", "P902"] },
                "TTNT": { teachers: ["Lê Thị S"], rooms: ["P1001"] }
            };

            let classData = courseData[course.id];
            if (!classData) return;

            course.times.forEach((timeSlot, index) => {
                let classId = `${course.id}-N0${index + 1}`;
                let teacher = classData.teachers[index % classData.teachers.length];
                let room = classData.rooms[index % classData.rooms.length];

                const classBox = document.createElement("div");
                classBox.className = "class-box";
                classBox.innerHTML = `<strong>${timeSlot.day} - ${timeSlot.time}</strong><br>Giáo viên: ${teacher}<br>Phòng: ${room}`;
                classBox.onclick = () => registerClass(classId, timeSlot, teacher, room);
                classContainer.appendChild(classBox);
            });
        }

        function registerClass(classId, timeSlot, teacher, room) {
            const userRef = ref(db, `students/${currentUserId}/registeredClasses/${classId}`);
            set(userRef, { day: timeSlot.day, time: timeSlot.time, teacher, room }).then(() => {
                alert(`Đăng ký thành công lớp ${classId}`);
                loadRegisteredClasses();
            });
        }

        function unregisterClass(classId) {
            const userRef = ref(db, `students/${currentUserId}/registeredClasses/${classId}`);
            remove(userRef).then(() => {
                alert(`Đã hủy đăng ký lớp ${classId}`);
                loadRegisteredClasses(); // Cập nhật lại danh sách đã đăng ký
            });
        }

        function loadRegisteredClasses() {
            const registeredList = document.getElementById("registered-classes");
            registeredList.innerHTML = "";

            get(ref(db, `students/${currentUserId}/registeredClasses`)).then((snapshot) => {
                if (snapshot.exists()) {
                    const classes = snapshot.val();
                    Object.keys(classes).forEach(classId => {
                        const li = document.createElement("li");
                        li.textContent = classId;
                        const removeBtn = document.createElement("button");
                        removeBtn.textContent = "Hủy";
                        removeBtn.onclick = () => unregisterClass(classId);
                        li.appendChild(removeBtn);
                        registeredList.appendChild(li);
                    });
                }
            });
        }
        window.onload = loadCourses;
        function logout() {
            signOut(auth).then(() => {
                window.location.href = "login.html";
            });
        }
    </script>
</body>

</html>